---
import { type CollectionEntry } from "astro:content";
import BlogCardButton from "@components/BlogCardButton.astro";
import { getFilteredCollectionEntries } from "@lib/utils";
import { BLOG } from "@consts";
import RootPageIndex from "@components/RootPageIndex.astro";

const { entries } = await getFilteredCollectionEntries("blog");

type Acc = {
  [year: string]: CollectionEntry<"blog">[];
};

const posts = entries.reduce((acc: Acc, post) => {
  const year = post.data.date.getFullYear().toString();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(post);
  return acc;
}, {});

const years = Object.keys(posts).sort((a, b) => parseInt(b) - parseInt(a));
---

<RootPageIndex title={BLOG.title}>
  {
    years.map((year) => (
      <section class="animate space-y-4">
        <div class="font-semibold text-black dark:text-white">{year}</div>
        <div>
          <ul class="not-prose flex flex-col gap-4">
            {posts[year].map((post) => (
              <li>
                <BlogCardButton entry={post} />
              </li>
            ))}
          </ul>
        </div>
      </section>
    ))
  }
</RootPageIndex>
