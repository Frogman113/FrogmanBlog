---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import { HOME, CONTACT, GLOBAL, type CollectionName } from "@consts";
import BlogCardButton from "@components/BlogCardButton.astro";
import ProjectCardButton from "@components/ProjectCardButton.astro";
import TalkCardButton from "@components/TalkCardButton.astro";
import Link from "@components/Link.astro";
import type { CollectionEntry } from "astro:content";
import { getFilteredCollectionEntries } from "@lib/utils";

async function getCollectionEntries<T extends CollectionName>(
  collectionName: T,
  maxItems: number,
): Promise<CollectionEntry<T>[]> {
  const { entries } = await getFilteredCollectionEntries(collectionName, {
    page: 1,
    pageSize: maxItems,
  });

  return entries;
}

const blog = await getCollectionEntries("blog", HOME.maxBlogItems ?? 0);

const projects = await getCollectionEntries(
  "projects",
  HOME.maxProjectItems ?? 0,
);

const talks = await getCollectionEntries("talks", HOME.maxTalkItems ?? 0);
---

<Layout title={GLOBAL.author}>
  <Container>
    <aside data-pagefind-ignore>
      <div class="flex items-center justify-center">
        <img
          src="/myphoto.png"
          alt={GLOBAL.author}
          class="h-48 w-48 rounded-full"
        />
      </div>
      <h1 class="font-semibold text-black dark:text-white">
        Hi, I'm {GLOBAL.author}
      </h1>
      <div class="space-y-16">
        <section>
          <article class="space-y-4">
            <span>
              <p>
                Astro Mili Dev is an accessible theme for <Link
                  href="https://astro.build/">Astro</Link
                >. It's a fork of <Link href="https://github.com/trevortylerlee"
                  >Trevor Lee's</Link
                > popular theme
                <Link href="https://astro.build/themes/details/astro-micro/"
                  >Astro Micro</Link
                >, which is a fork of
                <Link href="https://github.com/markhorn-dev">
                  Mark Horn's
                </Link>
                <Link href="https://astro.build/themes/details/astronano/"
                  >Astro Nano</Link
                >. Like Nano and Micro, Mili Dev comes with zero frameworks
                installed. The name "Mili Dev" refers to the next SI prefix
                after "micro" and "nano", and "dev", because it's mostly
                tailored for developers.
              </p>
              <p>
                Astro Mili Dev is mostly refactor and code cleanup (e.g., all
                collections are resolved in a single place and then reused).
              </p>
            </span>
            <span class="animate">
              <p>
                Visit
                <Link href="https://github.com/bartoszlenar/astro-mili-dev">
                  Astro Mili Dev on GitHub
                </Link>
                to fork the repository to get started.
              </p>
            </span>
          </article>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">
              Latest posts
            </h2>
            <Link href="/blog"> See all posts </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              blog.map((post) => (
                <li>
                  <BlogCardButton entry={post} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">
              Recent talks
            </h2>
            <Link href="/talks"> See all talks </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              talks.map((talk) => (
                <li>
                  <TalkCardButton entry={talk} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">
              Recent projects
            </h2>
            <Link href="/projects"> See all projects </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              projects.map((project) => (
                <li>
                  <ProjectCardButton entry={project} />
                </li>
              ))
            }
          </ul>
        </section>
      </div>
    </aside>
  </Container>
</Layout>
